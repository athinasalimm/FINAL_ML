{% extends "layout.html" %}

{% block content %}
<h2>游논 Estad칤sticas de usuarios de Ecobici</h2>
<label for="a침o-estadisticas">Eleg칤 un a침o:</label>
<select id="a침o-estadisticas" onchange="cargarEstadisticasUsuarios()">
    <option value="2020">2020</option>
    <option value="2021">2021</option>
    <option value="2022">2022</option>
    <option value="2023">2023</option>
    <option value="2024" selected>2024</option>
</select>
<div id="graficos-usuarios" style="margin-top: 2rem;"></div>

<div id="chart-container">
    <h2>游늵 Estad칤sticas de Usuarios</h2>
    <p>El gr치fico muestra los usuarios de ecobici que se han dado de alta en cada a침o.</p>
    <canvas id="chartAltas"></canvas>
</div>
{% endblock %}

{% block scripts %}
<script>
    function cargarEstadisticasUsuarios() {
        const a침o = document.getElementById("a침o-estadisticas").value;
        fetch(`/usuarios/${a침o}`)
            .then(resp => resp.json())
            .then(data => {
                document.getElementById("graficos-usuarios").innerHTML = data.html;
            });
    }

    // Cargar por defecto al inicio
    cargarEstadisticasUsuarios();

    // Cargar gr치fico de altas por a침o
    fetch("/api/altas_por_anio")
        .then(res => res.json())
        .then(data => {
            const ctx = document.getElementById("chartAltas").getContext("2d");
            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: Object.keys(data),
                    datasets: [{
                        label: "Altas por a침o",
                        data: Object.values(data),
                        backgroundColor: "rgba(255, 215, 0, 0.7)"
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
</script>
{% endblock %}
